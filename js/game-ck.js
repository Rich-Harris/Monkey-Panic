var MonkeyPanic=function(){};MonkeyPanic.prototype={init:function(){var a=this;this.el=document.getElementById("game");this.defaultState=this.el.innerHTML;this.reset();this.width=this.canvas.clientWidth,this.height=this.canvas.clientHeight,this.canvasOffset={left:game.canvas.getClientRects()[0].left,top:game.canvas.getClientRects()[0].top};window.requestAnimFrame=function(){return window.oRequestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();window.addEventListener("click",function(b){a.click.call(a,b)},!1);playBackgroundSound()},reset:function(){this.el.innerHTML=this.defaultState;this.status=document.getElementById("status");this.timerText=document.getElementById("timerText");this.timerBar=document.getElementById("timerBar");this.youLose=document.getElementById("youLose");this.canvas=document.getElementById("foreground");this.canvas.width=game.width;this.canvas.height=game.height;this.ctx=this.canvas.getContext("2d");this.tigers=[];this.monkeys=[];this.numPenalties=0},start:function(){var a;this.numTigers=1;this.numMonkeys=Math.floor(Math.random()*(config.maxMonkeys-config.minMonkeys)+config.minMonkeys);this.createGrid();this.placeTigers();this.placeMonkeys();this.startTime=(new Date).getTime();this.duration=config.duration;this.loop()},createGrid:function(){var a,b,c;this.availableSpaces=[];for(a=0;a<this.numMonkeys*this.numMonkeys;a+=1)this.availableSpaces[a]=a;this.squareWidth=this.width/this.numMonkeys;this.squareHeight=this.height/this.numMonkeys;this.ctx.strokeStyle="rgba(0,0,0,0.1)";for(b=1;b<=this.numMonkeys;b+=1){this.ctx.beginPath();this.ctx.moveTo(b*(this.canvas.width/this.numMonkeys),0);this.ctx.lineTo(b*(this.canvas.width/this.numMonkeys),this.canvas.height);this.ctx.closePath();this.ctx.stroke()}for(c=1;c<=this.numMonkeys;c+=1){this.ctx.beginPath();this.ctx.moveTo(0,c*(this.canvas.height/this.numMonkeys));this.ctx.lineTo(this.canvas.width,c*(this.canvas.height/this.numMonkeys));this.ctx.closePath();this.ctx.stroke()}},placeTigers:function(){for(i=0;i<this.numTigers;i+=1){square=this.getRandomSquare();coords=this.getRandomCoords(square);this.tigers[this.tigers.length]=new Tiger({game:this,coords:coords})}},placeMonkeys:function(){for(i=0;i<this.numMonkeys;i+=1){square=this.getRandomSquare();coords=this.getRandomCoords(square);this.monkeys[this.monkeys.length]=new Monkey({game:this,coords:coords})}},getRandomSquare:function(){var a,b={};a=Math.floor(Math.random()*this.availableSpaces.length);b.i=this.availableSpaces.splice(a,1);b.x=b.i%this.numMonkeys;b.y=Math.floor(b.i/this.numMonkeys);return b},getRandomCoords:function(a){var b=(a.x+config.gridPadding.x)*this.squareWidth,c=(a.y+config.gridPadding.y)*this.squareHeight;return{x:Math.floor(Math.random()*this.squareWidth*(1-2*config.gridPadding.x))+b,y:Math.floor(Math.random()*this.squareHeight*(1-2*config.gridPadding.y))+c}},loop:function(){var a=this;this.elapsed=(new Date).getTime()-this.startTime;this.timeRemaining=this.duration-(this.elapsed+this.numPenalties*config.missPenalty);if(this.timeRemaining<0)this.lose();else{requestAnimFrame(function(){a.loop()});this.updateTimer()}},updateTimer:function(){this.timerText.innerHTML=(this.timeRemaining/1e3).toFixed(1);this.timerBar.style.width=this.timeRemaining/this.duration*100+"%"},lose:function(){this.youLose.style.display="block"}};